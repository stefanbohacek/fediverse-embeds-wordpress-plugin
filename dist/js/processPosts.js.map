{"version":3,"file":"processPosts.js","names":["fetchData","getPostData","renderPost","dispatchEvent","processPosts","postsEmbeds","document","querySelectorAll","posts","post","postData","push","length","forEach","action","JSON","stringify","response","console","log"],"sources":["processPosts.js"],"sourcesContent":["import { fetchData } from \"./fetchData.js\";\nimport { getPostData } from \"./getPostData.js\";\nimport { renderPost } from \"./renderPost.js\";\nimport { dispatchEvent } from \"./dispatchEvent.js\";\n\nconst processPosts = (fn) => {\n  const postsEmbeds = document.querySelectorAll('blockquote.ftf-fediverse-post-embed');\n  let posts = [];\n\n  for (const post of postsEmbeds) {\n    const postData = getPostData(post);\n    posts.push(postData);\n  }\n  \n  // console.log('post data', posts);\n\n  if (posts.length){\n    posts.forEach(post => {\n      fetchData({\n        action: 'ftf_get_post',\n        post: JSON.stringify(post)\n      }, (response) => {\n        console.log('ftf_get_post', {post, response});\n        renderPost(response);\n      });\n    })\n  }\n};\n\nexport { processPosts };\n\n/***************************************************************************************************************/\n        //TODO: Old code for handling post attachments, might be useful for non-Mastodon platforms.\n        \n        // const postsWithAttachment = document.querySelectorAll('[data-url-attachment-processed=\"false\"]');\n        // let postsWithAttachmentCount = postsWithAttachment.length;\n        \n        // if (postsWithAttachmentCount === 0){\n        //   dispatchEvent('ftf_fediverse_embeds_posts_processed');\n        // }\n        \n        // // console.log('postsWithAttachment', postsWithAttachment);\n        \n        // for (const post of postsWithAttachment) {\n        //   post.dataset.urlAttachmentProcessed = 'true';\n          \n        //   // TODO: Render quotes.\n          \n        //   fetchData({\n        //     action: 'ftf_get_site_info',\n        //     url: post.dataset.urlAttachment\n        //   }, (data) => {\n        //     if (data && data.image){\n        //       let urlAttachmentPreview = document.createElement('div');\n        //       urlAttachmentPreview.className = `post-attachment-preview card mt-4`;\n              \n        //       let tmpAnchor = document.createElement ('a');\n        //       tmpAnchor.href = post.dataset.urlAttachment;\n              \n        //       let urlAttachmentPreviewHTML = '';\n        //       // console.log('debug:data.image', data.image);\n        //       if (data.image){\n        //         urlAttachmentPreviewHTML += `<a href=\"${ post.dataset.urlAttachment }\"><img loading=\"lazy\" class=\"post-attachment-site-thumbnail card-img-top\" src=\"${window.ftf_fediverse_embeds.blog_url}/wp-json/ftf/media-proxy?url=${ encodeURI(data.image) }\" alt=\"Preview image for ${post.dataset.urlAttachment}\"></a>`;\n        //       }\n              \n        //       urlAttachmentPreviewHTML += `<div class=\"card-body\">`;\n        //       urlAttachmentPreviewHTML += `<p class=\"card-text\"><a class=\"stretched-link text-muted\" href=\"${ post.dataset.urlAttachment }\" target=\"_blank\">${ tmpAnchor.hostname }</a></p>`;\n              \n        //       if (data.title){\n        //         urlAttachmentPreviewHTML += `<p class=\"card-title\">${ data.title }</p>`;\n        //       }\n              \n        //       if (data.description){\n        //         urlAttachmentPreviewHTML += `<p class=\"card-subtitle mb-2 text-muted\">${ data.description }</p>`;\n        //       }\n              \n        //       urlAttachmentPreviewHTML += `</div>`;\n              \n        //       urlAttachmentPreview.innerHTML = urlAttachmentPreviewHTML;\n        //       post.querySelector('.post-body-wrapper').appendChild(urlAttachmentPreview);\n        //     }\n            \n        //   }, () => {\n        //     postsWithAttachmentCount--;\n        //     // console.log('postsWithAttachmentCount', postsWithAttachmentCount);\n        //     if (postsWithAttachmentCount === 0){\n        //       dispatchEvent('ftf_fediverse_embeds_posts_processed');\n        //     }\n        //   });                           \n        // }\n"],"mappings":"AAAA,OAASA,SAAS,KAAQ,gBAAgB,CAC1C,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,UAAU,KAAQ,iBAAiB,CAC5C,OAASC,aAAa,KAAQ,oBAAoB,CAElD,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAQ,CAC3B,KAAM,CAAAC,WAAW,CAAGC,QAAQ,CAACC,gBAAgB,CAAC,qCAAqC,CAAC,CACpF,GAAI,CAAAC,KAAK,CAAG,EAAE,CAEd,IAAK,KAAM,CAAAC,IAAI,GAAI,CAAAJ,WAAW,CAAE,CAC9B,KAAM,CAAAK,QAAQ,CAAGT,WAAW,CAACQ,IAAI,CAAC,CAClCD,KAAK,CAACG,IAAI,CAACD,QAAQ,CACrB,CAEA;AAEIF,KAAK,CAACI,MAAM,EACdJ,KAAK,CAACK,OAAO,CAACJ,IAAI,EAAI,CACpBT,SAAS,CAAC,CACRc,MAAM,CAAE,cAAc,CACtBL,IAAI,CAAEM,IAAI,CAACC,SAAS,CAACP,IAAI,CAC3B,CAAC,CAAGQ,QAAQ,EAAK,CACfC,OAAO,CAACC,GAAG,CAAC,cAAc,CAAE,CAACV,IAAI,CAAEQ,QAAQ,CAAC,CAAC,CAC7Cf,UAAU,CAACe,QAAQ,CACrB,CAAC,CACH,CAAC,CAEL,CAAC,CAED,OAASb,YAAY,EAErB,kHACQ;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}